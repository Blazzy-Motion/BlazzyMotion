@namespace BlazzyMotion.Bento.Components
@using Microsoft.AspNetCore.Components.Web
@typeparam TItem where TItem : class
@inherits BlazzyMotion.Core.Abstractions.BzComponentBase

<HeadContent>
    <link rel="stylesheet" href="_content/BlazzyMotion.Core/css/blazzy-core.css" />
</HeadContent>

@if (IsLoading)
{
    <div class="bz-loading" @attributes="AdditionalAttributes">
        @if (LoadingTemplate != null)
        {
            @LoadingTemplate
        }
        else
        {
            <div class="bz-spinner"></div>
            <p>Loading grid...</p>
        }
    </div>
}
else if (IsEmpty && ChildContent == null)
{
    <div class="bz-empty" @attributes="AdditionalAttributes">
        @if (EmptyTemplate != null)
        {
            @EmptyTemplate
        }
        else
        {
            <p>No items to display</p>
        }
    </div>
}
else if (ChildContent != null)
{
    @* COMPOSITION MODE - User provides BzBentoCard, BzBentoMetric, etc. *@
    <div class="@GetCombinedClass("bzb-grid")"
         @ref="_gridRef"
         style="@GetGridStyle()"
         @attributes="AdditionalAttributes">
        @ChildContent
    </div>
}
else
{
    @* ITEMS MODE - Auto-generated grid from Items collection *@
    <div class="@GetCombinedClass("bzb-grid")"
         @ref="_gridRef"
         style="@GetGridStyle()"
         @attributes="AdditionalAttributes">
        @{
            var index = 0;
            foreach (var item in Items!)
            {
                var currentIndex = index;
                var currentItem = item;
                var bzItem = GetMappedItem(item, currentIndex);

                <div class="bzb-item @GetSpanClasses(bzItem)"
                     style="@GetItemStyle(bzItem)"
                     tabindex="0"
                     @onclick="@(() => HandleItemClick(currentItem))"
                     @onkeydown="@((KeyboardEventArgs e) => HandleKeyDown(e, currentItem))">
                    @GetItemContent(item, currentIndex)
                </div>

                index++;
            }
        }
    </div>
}
